// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AuthUser {
  id                String   @id @unique
  username          String   @unique
  email             String   @unique
  profile_picture   String
  tournamentsPlayed Int      @default(0)
  prizeWon          Int      @default(0)
  role              Role     @default(user)
  website           String?
  join_date         DateTime @default(now())
  xp                Int      @default(0)
  level             Int      @default(0)

  auth_session      AuthSession[]
  auth_key          AuthKey[]
  TournamentPlayers TournamentPlayers[]
  Tournament        Tournament[]

  @@map("auth_user")
}

enum Role {
  user
  admin
  organization
}

model Game {
  id               String   @id @unique
  game_cover       String   @default("game.png")
  game_background  String?
  game_showcase    String?
  game_name        String
  game_description String
  game_tags        String[]
  game_website     String?
}

model Tournament {
  id                String              @id @unique
  cover_image       String              @default("tournament.png")
  background_image  String?
  tags              String[]
  title             String
  startOn           DateTime
  description       String
  game              String
  prize             Int
  team_size         String
  max_slots         Int
  type              String
  host              AuthUser            @relation(fields: [authUserId], references: [id])
  status            TournamentStatus    @default(scheduled)
  TournamentPlayers TournamentPlayers[]
  authUserId        String
}

enum TournamentStatus {
  active
  ended
  scheduled
}

model TournamentPlayers {
  id           String     @id @unique
  Tournament   Tournament @relation(fields: [tournamentId], references: [id])
  tournamentId String
  AuthUser     AuthUser   @relation(fields: [authUserId], references: [id])
  authUserId   String
}

model Tag {
  id   String @id @unique
  tag  String
  slug String
}

model AuthSession {
  id             String   @id @unique
  user_id        String
  active_expires BigInt
  idle_expires   BigInt
  auth_user      AuthUser @relation(references: [id], fields: [user_id], onDelete: Cascade)

  @@index([user_id])
  @@map("auth_session")
}

model AuthKey {
  id              String   @id @unique
  hashed_password String?
  user_id         String
  primary_key     Boolean
  expires         BigInt?
  auth_user       AuthUser @relation(references: [id], fields: [user_id], onDelete: Cascade)

  @@index([user_id])
  @@map("auth_key")
}
